<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>University AI Chatbot</title>

<style>
  body {
     margin:0;
     font-family:Arial,sans-serif;
     display:flex;
     height:100vh;
     background:#f5f5f5;
     -webkit-tap-highlight-color: transparent;
 }

  .sidebar {
      width:200px;
      background:#fff;
      border-right:1px solid #ddd;
      padding:20px;
      box-sizing:border-box;
      display:flex;
      flex-direction:column;
 }

  .sidebar h2 { margin:0 0 10px 0; font-size:18px; }

  .chat-list { 
      flex:1;
      overflow-y:auto;
      -webkit-overflow-scrolling: touch;
 }

  .chat-item { 
      padding:10px;
      margin-bottom:5px;
      border-radius:8px;
      cursor:pointer;
      display:flex;
      justify-content:space-between;
      align-items:center;
 }

  .chat-item:hover { background:#ececec; }

  .chat-item.active { 
      background:#cce5ff;
      font-weight:bold;
 }

  .main {
      flex:1;
      display:flex;
      flex-direction:column;
 }

  .header {
      padding:15px 20px;
      background:#fff;
      border-bottom:1px solid #ddd;
      font-weight:bold;
 }

  .chat-window {
      flex:1;
      padding:20px;
      overflow-y:auto;
      display:flex;
      flex-direction:column;
      -webkit-overflow-scrolling: touch;
 }

  .message {
      margin-bottom:15px;
      max-width:90%;
      padding:12px 16px;
      border-radius:10px;
      line-height:1.4;
 }

  .bot { background:#e8eefa; align-self:flex-start; }
  .user { background:#c6e8c5; align-self:flex-end; }

  .input-area {
      display:flex;
      padding:15px;
      background:#fff;
      border-top:1px solid #ddd;
 }

  .input-area input {
      flex:1;
      padding:10px;
      border:1px solid #ccc;
      border-radius:8px;
      font-size:14px;
 }

  .input-area button {
      margin-left:10px;
      padding:10px 16px;
      border:none;
      border-radius:8px;
      background:#0055aa;
      color:#fff;
      cursor:pointer;
 }
  .input-area button:hover { background:#003f80; }

  .chat-item-name {
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      max-width:140px;
 }

  .chat-item:hover .chat-item-name {
      overflow:visible;
      white-space:normal;
 }
</style>
</head>

<body>

<div class="sidebar">
  <h2>University AI Chatbot</h2>
  <div class="chat-list" id="chatList"></div>
  <div class="chat-item add-new" id="addChat">
    ＋ 添加新對話
  </div>
</div>

<div class="main">
  <div class="header">University AI Chatbot</div>
  <div class="chat-window"></div>
  <div class="input-area">
    <input type="text" placeholder="輸入你的問題...">
    <button type="button" id="sendBtn">送出</button>
  </div>
</div>

<script>

// -------------------------------
// 通用：同時綁 click + touchstart
// -------------------------------
function bindTouchClick(element, handler) {
  ["touchstart", "click"].forEach(ev => {
    element.addEventListener(ev, function(e){
      e.preventDefault();
      handler(e);
    }, { passive:false });
  });
}

// -------------------------------
const chatList = document.getElementById('chatList');
const addChat = document.getElementById('addChat');
const chatWindow = document.querySelector('.chat-window');
const sendBtn = document.getElementById('sendBtn');
const input = document.querySelector('.input-area input');

let chatHistory = {};
let currentChatId = null;

// -------------------------------
function renderChat() {

  document.querySelectorAll('.chat-item').forEach(item => {
    if(item.dataset.chatId == currentChatId) item.classList.add('active');
    else item.classList.remove('active');
  });

  if(!currentChatId || !chatHistory[currentChatId]) {
    chatWindow.innerHTML = '';
    return;
  }

  chatWindow.innerHTML = chatHistory[currentChatId].messages
    .map(msg => `<div class="message ${msg.role}">${msg.text}</div>`)
    .join('');

  chatWindow.scrollTop = chatWindow.scrollHeight;
}

// -------------------------------
function attachItemEvents(item, chatId) {

  // 點選切換對話
  bindTouchClick(item, (e)=>{
    if(e.target.classList.contains('delete-btn')) return;
    currentChatId = chatId;
    renderChat();
  });

  // 刪除
  const del = item.querySelector('.delete-btn');
  if(del){
    bindTouchClick(del, ()=>{
      if(confirm('確定要刪除此對話嗎？')) {
        delete chatHistory[chatId];
        item.remove();
        if(currentChatId === chatId){
          currentChatId = null;
          renderChat();
        }
      }
    });
  }
}

// -------------------------------
function addNewChat(defaultName="新對話") {

  const chatId = Date.now();
  chatHistory[chatId] = {
    name: defaultName,
    messages: [{role:"bot", text:"Hello~有咩幫到你?"}],
    isNameSet:false
  };

  const item = document.createElement('div');
  item.className = "chat-item";
  item.dataset.chatId = chatId;
  item.innerHTML = `
      <span class="chat-item-name">${defaultName}</span>
      <span class="delete-btn">✕</span>
  `;

  chatList.appendChild(item);
  attachItemEvents(item, chatId);

  currentChatId = chatId;
  renderChat();
}

// -------------------------------
function sendMessage() {

  const text = input.value.trim();
  if(!text || !currentChatId) return;

  const chat = chatHistory[currentChatId];

  if(!chat.isNameSet){
    chat.name = text;
    chat.isNameSet = true;
    document.querySelector(
      `.chat-item[data-chat-id="${currentChatId}"] .chat-item-name`
    ).textContent = text;
  }

  chat.messages.push({role:"user", text});
  chat.messages.push({role:"bot", text:"OK"});

  input.value = "";
  renderChat();
}

// -------------------------------
// 綁定 iPhone 兼容事件
// -------------------------------
bindTouchClick(sendBtn, sendMessage);
bindTouchClick(addChat, ()=> addNewChat());

// Enter 發送（iPhone 要用 keydown）
input.addEventListener("keydown", e=>{
  if(e.key==="Enter"){
    e.preventDefault();
    sendMessage();
  }
});

// 頁面一進來自動產生對話
addNewChat();

</script>
</body>
</html>


